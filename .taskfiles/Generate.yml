version: "3"

vars:
  ROOT:
    sh: git rev-parse --show-toplevel

tasks:
  pkl:
    desc: Generate PKL files
    silent: true
    dir: "{{.ROOT}}/pkl/sonr.net"
    vars:
      FILES: ["Hway.pkl", "Motr.pkl", "UCAN.pkl"]
    cmds:
      - for: { var: FILES }
        cmd: pkl-gen-go {{.ITEM}}
  
  proto:
    desc: Generate proto files
    silent: true
    dir: "{{.ROOT}}"
    cmd: make proto-gen

  sqlc:
    desc: Generate SQLC files
    silent: true
    dir: "{{.ROOT}}"
    cmds:
      - sqlc generate -f internal/database/sqlc.yaml

  templ:
    desc: Generate templ files
    silent: true
    dir: "{{.ROOT}}"
    cmd: templ generate
